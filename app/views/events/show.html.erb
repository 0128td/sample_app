<div class="schedule-container">
<div class="schedule-header">
  <a href="/events/index">戻る</a>
  <h1>スケジュール確認・登録</h1>
<h3>スケジュールの内容</h3>
<% if @administrator_user %>
<%= form_with url:"/events/#{@event.id}/update" do |form| %>
タイトル：<input type="text" class="event-title" name="title" value="<%=@event.title%>"><br>
開始　　：<input type="date" class="event-date" name="start_date" value="<%=@event.start.strftime("%Y-%m-%d")%>">
      <%=select_tag "start_hour", options_for_select([["6時", "06"],["7時","07"],["8時","09"],["9時","09"],["10時", "10"],["11時","11"],["12時","12"],["13時","13"],["14時", "14"],["15時","15"],["16時","16"],["17時","17"],["18時","18"],["19時","19"],["20時","20"],["21時","21"]], :selected=> @event.start.strftime("%H")) ,class: "select" %>
      <%=select_tag "start_min", options_for_select([["00分", "00"],["05分","05"],["10分","10"],["15分","15"],["20分", "20"],["25分","25"],["30分","30"],["35分","35"],["40分", "40"],["45分","45"],["50分","50"],["55分","55"]], :selected=>"00", :selected=> @event.start.strftime("%M")) ,class: "select" %><br>
終了　　：<input type="date" class="event-date" name="end_date" value="<%=@event.end.strftime("%Y-%m-%d")%>">
      <%=select_tag "end_hour", options_for_select([["6時", "06"],["7時","07"],["8時","09"],["9時","09"],["10時", "10"],["11時","11"],["12時","12"],["13時","13"],["14時", "14"],["15時","15"],["16時","16"],["17時","17"],["18時","18"],["19時","19"],["20時","20"],["21時","21"]], :selected=> @event.end.strftime("%H")) ,class: "select" %>
      <%=select_tag "end_min", options_for_select([["00分", "00"],["05分","05"],["10分","10"],["15分","15"],["20分", "20"],["25分","25"],["30分","30"],["35分","35"],["40分", "40"],["45分","45"],["50分","50"],["55分","55"]], :selected=>"00", :selected=> @event.end.strftime("%M")) ,class: "select" %><br>
場所　　：<%= collection_select(:map_id, :id, Map.all, :id, :place, include_blank: true, selected: @event.map_id ) %>

  <div class="schedule-btn">
        <input class="submit-btn" type="submit" value="更新">
      <%end%>

      <%= form_with url:"/events/#{@event.id}/destroy" do |form| %>
        <input class="submit-btn" type="submit" value="削除">
      <%end%>
  </div>

<% else %>

<p>タイトル：<%=@event.title %></p>
<p>開始　　：<%=@start %></p>
<p>終了　　：<%=@end %></p>
<p>場所　　：<%=@map&.place %></p>
<p>場所情報：<%=@map&.map_comment %></p>
<div class="schedule-map">
         <input id="ido" value="<%=@map&.latitude%>" type="hidden">
         <input id="keido" value="<%=@map&.longitude%>" type="hidden">
         <div class ="map-view">
         <script type="text/javascript">

             function initMap() {
                 var ido = document.getElementById('ido').value
                 var keido = document.getElementById('keido').value
                 var latlng = new google.maps.LatLng(ido, keido);//中心の緯度, 経度
                 var map = new google.maps.Map(document.getElementById('map'), {
                   zoom: 16,　//ズームの調整
                   center: latlng　//上で設定した中心
                 });
                 var marker = new google.maps.Marker({　//初期の位置の中心にマーカ設定
                   position: latlng,
                   map: map
                 });
               }

         </script>

         <div id="map">
           <script async defer src="https://maps.googleapis.com/maps/api/js?language=ja&region=JP&key=AIzaSyCtVfq2uxRKH5Nm-EQoOd_puwNwAvTVdBk&callback=initMap">
           </script>
         </div>
         </div>

</div>

<%end%>

</div>

<% if @current_user %>
  <div class="schedule-show-attendance">
  <h3><%=@current_user.name %>　さんの出欠登録</h3>
  <% if @atd&.attendance == 0 %>
    <%=form_tag("/events/#{@event.id}/attendance_update")do %>
      <input type="radio" name="attendance" value="0" checked="checked">出席
      <input type="radio" name="attendance" value="1">欠席
      <br>
      <textarea name="memo" rows="2" cols="40" placeholder="メモ入力欄"><%=@atd.memo%></textarea>
      <br>
      <input id="submit-btn" type="submit" value="登録">
      <%end%>

  <% elsif @atd&.attendance == 1 %>
    <%=form_tag("/events/#{@event.id}/attendance_update")do %>
      <input type="radio" name="attendance" value="0">出席
      <input type="radio" name="attendance" value="1" checked="checked">欠席
      <br>
      <textarea name="memo" rows="2" cols="40" placeholder="メモ"><%=@atd.memo%></textarea>
      <br>
      <input id="submit-btn" type="submit" value="登録">
      <%end%>

  <% else %>
    <%=form_tag("/events/#{@event.id}/attendance_create")do %>
      <input type="radio" name="attendance" value="0" checked="checked">出席
      <input type="radio" name="attendance" value="1">欠席
      <br>
      <textarea name="memo" rows="2" cols="40" placeholder="メモ"></textarea>
      <br>
      <input id="submit-btn" type="submit" value="登録">
      <%end%>

  <%end%>

  </div>

  <%end%>



<div class="schedule-show-index">
<h3>メンバー参加状況</h3>
<table>
<tr>
<th style="width:30%;">　名前　</th>
<th style="width:10%;">　出席　</th>
<th style="width:10%;">　欠席　</th>
<th>　メモ　</th>
</tr>
<% @atds.each do |atd|%>

<tr>
<td>
  <% user = User.find_by(id: atd.user_id)%>
  <%=user.name%>
</td>
<% if atd.attendance == 0 %>
  <td>〇</td>
<%else%>
  <td></td>
<%end%>

<% if atd.attendance == 1 %>
  <td>〇</td>
<%else%>
  <td></td>
<%end%>

<% if atd.memo == nil %>
  <td></td>
<%else%>
  <td><%=atd.memo %></td>
<%end%>
</tr>
<%end%>

<tr style="font-weight: bold; font-size:14px;">
  <td>合計：<%=@atds.count %>人</td>
  <td>出席：<%=@atds.where(attendance:0).count %>　人</td>
  <td>欠席：<%=@atds.where(attendance:1).count %>　人</td>
  <td></td>
</tr>

</table>

<%%>


</div>


</div>
